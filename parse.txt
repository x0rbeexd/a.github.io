awk '$6 ~ /READ|WRITE/ { print $2, $4, $5, $6 }' nxc_output.txt > filtered_shares.txt



#!/bin/bash

INPUT="nxc_output.txt"
OUTPUT="final_filtered_grouped.txt"

# List of excluded system shares
EXCLUDE_RE="^(C\$|ADMIN\$|IPC\$|NETLOGON|SYSVOL)$"

> "$OUTPUT" # Clear output

awk -v exclude="$EXCLUDE_RE" '
$6 == "Enumerated" && $7 == "shares" {
    current_ip = $2;
    current_host = $4;
    print current_ip, current_host >> "'$OUTPUT'"
    next
}

$6 ~ /READ|WRITE/ && $5 !~ exclude {
    printf "    %-20s %s\n", $5, $6 >> "'$OUTPUT'"
}
' "$INPUT"

echo "[+] Grouped output saved to $OUTPUT"




import xlsxwriter
import re

INPUT_FILE = "nxc_output.txt"
OUTPUT_FILE = "parsed_shares.xlsx"

# Excluded system shares
EXCLUDED_SHARES = {"ADMIN$", "C$", "IPC$", "NETLOGON", "SYSVOL"}

# Output Excel file
workbook = xlsxwriter.Workbook(OUTPUT_FILE)
worksheet = workbook.add_worksheet("Filtered SMB Shares")
headers = ["IP", "Hostname", "Share", "Permissions"]
for col, header in enumerate(headers):
    worksheet.write(0, col, header)

row = 1
current_ip = ""
current_hostname = ""

with open(INPUT_FILE, "r", encoding="utf-8") as f:
    for line in f:
        line = line.strip()

        # Detect host + hostname block
        if re.search(r"\[\*\] Enumerated shares$", line):
            parts = line.split()
            if len(parts) >= 5:
                current_ip = parts[1]
                current_hostname = parts[3]

        # Skip column headers / dashes / irrelevant lines
        if any(x in line for x in ["Share", "-----", "Enumerated shares"]):
            continue

        # Parse valid share line
        parts = line.split()
        if len(parts) < 6 or parts[0] != "SMB":
            continue

        share_name = parts[4]
        permission = parts[5] if parts[5] in ["READ", "WRITE", "READWRITE"] else ""

        # Skip excluded shares and empty permissions
        if share_name in EXCLUDED_SHARES or not permission:
            continue

        # Write to Excel
        worksheet.write(row, 0, current_ip)
        worksheet.write(row, 1, current_hostname)
        worksheet.write(row, 2, share_name)
        worksheet.write(row, 3, permission)
        row += 1

workbook.close()
print(f"[+] Done. Parsed {row - 1} shares. Output: {OUTPUT_FILE}")

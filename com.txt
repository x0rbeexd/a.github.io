$hosts = Get-Content "livehosts.txt"
$outputDir = "$PWD\HostReports"
if (!(Test-Path $outputDir)) { New-Item -Path $outputDir -ItemType Directory | Out-Null }

foreach ($host in $hosts) {
    $outFile = Join-Path $outputDir "$host.txt"
    "=== Recon for $host ===`n" | Set-Content $outFile

    # Hostname
    try {
        $hostname = ([System.Net.Dns]::GetHostEntry($host)).HostName
        "Hostname: $hostname" | Tee-Object -FilePath $outFile -Append
    } catch {
        "Hostname: Unknown" | Tee-Object -FilePath $outFile -Append
    }

    # SMB Shares
    try {
        "Shares:" | Tee-Object -FilePath $outFile -Append
        net view \\$host | Tee-Object -FilePath $outFile -Append
    } catch {
        "Error viewing shares" | Tee-Object -FilePath $outFile -Append
    }

    # Attempt Null Session
    try {
        "Attempting IPC$ Null Session..." | Tee-Object -FilePath $outFile -Append
        net use \\$host\IPC$ "" /user:"" | Tee-Object -FilePath $outFile -Append
    } catch {
        "Null session failed" | Tee-Object -FilePath $outFile -Append
    }

    # User sessions (WMI)
    try {
        $user = (Get-WmiObject -Class Win32_ComputerSystem -ComputerName $host -ErrorAction Stop).UserName
        "Logged in user: $user" | Tee-Object -FilePath $outFile -Append
    } catch {
        "Logged in user: Unknown or access denied" | Tee-Object -FilePath $outFile -Append
    }

    "`n" | Tee-Object -FilePath $outFile -Append
}
